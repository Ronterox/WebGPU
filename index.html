<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8" />
		<title>WebGPU Life</title>
	</head>
	<body>
		<h1 id="log"></h1>
		<canvas width="512" height="512"></canvas>
		<script type="module">
			const canvas = document.querySelector("canvas");

			function log(msg, error = false) {
				document.getElementById("log").innerHTML = "LOG: " + msg + "<br>";
				if (error) {
					document.getElementById("log").style.color = "red";
					throw new Error(msg);
				}
			}

			// Your WebGPU code will begin here!
			if (!navigator.gpu) log("WebGPU is not supported!", true);

			log("WebGPU is supported!");
			console.log(navigator.gpu);

			const adapter = await navigator.gpu.requestAdapter();
			if (!adapter) log("No adapter found!", true);
			log("Adapter found!");
			console.log(adapter);

			const device = await adapter.requestDevice();
			const context = canvas.getContext("webgpu");
			const canvasFormat = context.getPreferredFormat();
			context.configure({ device: device, format: canvasFormat });

			const encoder = device.createCommandEncoder();
			const pass = encoder.beginRenderPass({
				colorAttachments: [
					{
						view: context.getCurrentTexture().createView(),
						loadOp: "clear",
						storeOp: "store",
					},
				],
			});
			pass.end();

			device.queue.submit([encoder.finish()]);
		</script>
	</body>
</html>
